# 梦中情人 DreamLover

[TOC]

## 用途 Usages

+ <font size=5>被爱</font>
  + 支持充分的条件**筛选**
  + 支持npc主动爱慕、表白与求婚
  + 雨恨云愁
+ <font size=5>欺辱</font>
  + 太吾过月时(作为npc)欺辱他人
  + 支持部分条件筛选
+ <font size=5>主动欺辱</font>
  + 需要安装txtmod
  + 支持指定参数
+ <font size=5>怀孕</font>
  + 指定（单方或双方）生育能力
  + 指定怀孕概率和异胎概率
+ <font size=5>防绿</font>
  + 防止特定人群的配偶出轨

## <del>简单易懂的</del>使用说明 Tutorial

*该使用说明也是功能的详细介绍，建议了解。*

*由于该Mod的功能多样且复杂，因此逐个页面介绍。*

### 被追求设置页

#### 首先打开Mod后，默认页面如图。

![t1_f1](D:\GitHub\Taiwu_mods\DreamLover\images\t1_f1.png)

该页面可以分为七个区域：

①页面切换：这里的四个选项只能同时选择一个，选择后，切换到对应的页面。**该选项只控制显示哪个模块的页面，不控制是否开启或者关闭功能。**

②调试模式：调试模式可以详细描述mod执行过程中发生的事情，方便找出mod不生效的原因，**对功能没有影响**。

③功能开关：这里有三个选项：“主动爱慕”（npc是否会主动对主角倾心爱慕），“主动表白”（爱慕主角的npc在月初是否主动向主角表白，成为两情相悦关系）和“主动求婚”（两情相悦的npc在月初是否主动向主角求婚）。**当这些功能都关闭时，该页面所在的模块会被卸载，游戏速度将不会受到“被爱”这个模块的影响。**

④通用配置基础部分：顾名思义，前两者表示什么性别的人可以主动向npc求爱（我们规定，对主角的两性关系上升的行为称为求爱，无关系->倾心爱慕->两情相悦->结发夫妻）。而“爱慕不受地理限制”，是因为游戏机制中，爱慕可以在不同格子发生，而表白和求婚只能在同格子，但是，如果不受地理限制，可能会吸引过多人对npc产生爱慕之情，因此默认关闭，如果打开，全世界符合条件的人都会（在下个月过月时）爱上主角；

⑤通用配置关系部分：游戏内有些关系默认无法产生情感纠纷，例如兄弟姐妹，亲子关系等。而在这里勾选某个关系，可以解除限制，例如勾选了“亲父亲母”，则你的子女会主动向你求爱。

⑥通用配置强化筛选部分：这里支持了更详细的筛选，只有满足了每行条件的人，才能主动向主角求爱，例如，当前的规定是“年龄在14-58岁之间”且“未相枢化”（即没有相枢入邪和相枢化魔）且“立场为任意立场”（勾选了全部立场）且“好感度大于等于热忱”且“魅力高于出众”且“阶层为任意品级”，只有同时满足这几点的人，才能向主角求爱；如果不想要筛选，可以把所有内容都勾选上，即无条件限制；利用严格的条件限制加上“不受地理限制”，可以实现让所有满足条件的人对主角心生爱慕。

⑦试验功能：由于游戏的月初事件机制，因此表白和求婚事件可能会因为事件过多而不发生，利用强制最先发生的选项，可以让事件必然发生（如果未能发生，可能是对方离开了这个格子）；

#### 当主动表白或主动求婚打开时，会出现两个新的功能控制区域，如图。

![t1_f23](D:\GitHub\Taiwu_mods\DreamLover\images\t1_f23.png)

主动表白相关配置因为已经有了介绍，因此不做赘述。

主动求婚的配置，简单来说分为三类。

第一类：能否有一夫多妻/一妻多夫：

①已婚人士：选中后，已经结婚的npc也会向主角求婚；

②太吾多配偶制：选中后，npc会无视太吾婚姻状况，向主角求婚；

第二类：是否受门派制度限制：

③无视门派规章：选中后，少林、璇女等对婚嫁有限制的门派子弟，也能主动向太吾求婚。**注意，该功能只是解除门派限制，不解除身份限制，可能需要配合“出家人”使用**；

第三类：是否受出家身份限制：

④出家人：选中后，和尚、尼姑等也会对太吾主动求婚。

⑤太吾出家也要求婚：选中后，npc会无视太吾是否出家，向主角求婚。

#### 当关闭三个功能时，会出现新功能“雨恨云愁”

![t1_f4](D:\GitHub\Taiwu_mods\DreamLover\images\t1_f4.png)

### 情难自已设置页

在页面切换中选择了“情难自己设置页”后，就可以控制这方面的设定。

![t2](D:\GitHub\Taiwu_mods\DreamLover\images\t2.png)

首先介绍欺辱行为：欺辱是游戏机制内置的过月事件，人物在过月时，根据七元，有概率对与其同格的人进行欺辱。欺辱过程中，首先进行战斗力判定，如果战力低于被欺辱者，则欺辱失败，反之成功。欺辱后，双方情绪会发生一定改变。如果受害人对嫌疑人有爱慕心，则会对其势不两立，否则，对嫌疑人产生血海深仇。在欺辱结束后，进行正常的春宵判定，如果成功怀孕，则孩子的双亲中，只与受害人有亲子关系关系。

该页面分为三个区域：

①通用配置：这里是对欺辱行为的各个阶段进行规定，可以参考上面对欺辱行为的介绍；如果选中“不留记录”，则双方经历中不保留该欺辱的经历。

②发生关系配置：如果使用了发生关系的txtmod，即主动欺辱，则可以在这里进行配置，如果选中“覆盖传入参数”，则采用通用配置处理主动欺辱行为，反之，采用txtmod规定的效果，如果没有规定，则使用默认参数。*txtmod可以参考该页面底部的杂项*

③过月时欺辱配置：这里是过月时的自动欺辱。“启用过月自动欺辱”用来控制该功能是否开启，**如果关闭，该页面所在的模块会被卸载，对游戏速度不产生影响，但不影响txtmod的效果**。“指定概率”开启后，可以指定主角去欺辱别人的概率，如果关闭，则根据游戏内置机制决定概率。“仅太吾爱慕的人”开启后，主角只会欺辱其喜欢的人，可以用来筛选欺辱目标。“仅异性”开启后，主角只会欺辱异性，可以用来筛选欺辱目标。“指定名称”开启后，可以指定欺辱对象的名称，用来强效筛选欺辱目标，当框内为空时，则不进行名称匹配，当框内为“李”时，可以欺辱“李四”或者“杨桃李”，当框内为全名时，则只欺辱对应的人。

### 怀孕设置页

![t3](D:\GitHub\Taiwu_mods\DreamLover\images\t3.png)

当切换至怀孕设置页的时候，可见类似如图。

***注意：该功能为独立生育函数，无法与其他类似mod兼容，如 “ji友传说 ” 等，建议当使用时，卸载其中一方，否则只会生效一个。***

***特别的，该mod的此功能模块可自动卸载，因此，建议关闭本mod的指定怀孕功能与防绿功能。***

“启用指定怀孕功能”：用来控制是否要指定太吾与他人发生关系时的怀孕概率，**如果与防绿功能都关闭，则该模块会被卸载，对游戏速度不产生影响。**

“指定总生育能力”：是否指定生育能力，如果开启，可在后面格子内填写任一整数，越大则生育能力越强。如果不指定，则该数值为父母双方生育能力的乘积，且每个人的生育能力与性别、年龄相关，青年时达到最大值。

“指定怀孕概率”：是否指定生育能力，如果开启，可在后面格子内填写任一整数，越大则怀孕概率越高。

“指定蛐蛐概率”：是否指定异胎概率，如果开启，可在后面格子内填写任一整数，越大则越可能出现异胎。

### 防绿设置页

![t4](D:\GitHub\Taiwu_mods\DreamLover\images\t4.png)

当切换至怀孕设置页的时候，可见类似如图。

“启用防绿功能”：用来控制是否要指定发生关系双方都不是太吾时，能否正常进行，**如果与指定怀孕功能都关闭，则该模块会被卸载，对游戏速度不产生影响。**

“能与配偶发生关系”：如果关闭，则符合条件者的配偶无法与任何人发生关系；打开后，符合条件者的配偶可以与其合法配偶发生关系。

“想要控制的关系”：想要控制哪些人的发生关系行为。例如，选中“儿女子嗣”的时候，则太吾子女的配偶不能与其他人发生关系，只能与ta的合法配偶（你的儿女子嗣）或者太吾本人，发生关系，<del>特别地，如果关闭了“能与配偶发生关系”，则你的儿媳妇只能和你发生关系</del>。

### 调试模式

当开启调试模式后，可以查看事件日志。

![logs_1](D:\GitHub\Taiwu_mods\DreamLover\images\logs_1.png)

首先打开 ①Debug Mode，此时打开了调试模式。

随后，在你认为应该发生某一事件（如求爱、欺辱、怀孕），但是没有发生时，打开 ②Logs，进入 Unity Mod Manager 的日志页面。

![logs_2](D:\GitHub\Taiwu_mods\DreamLover\images\logs_2.png)

如图，这里可以看到每个人没能成功的原因。

例如第一行，“艾惟学”之所以没能主动追求主角，是因为其对主角的好感度是“素未谋面”，不符合“被追求设置页”设置的内容，因此判定失败，要想成功，可以主动与该npc交互，提高好感，或者在对应的配置中，允许“素未谋面”关系。

## 更新日志 Updates
### 1.0.0
 游戏的梦境中人仅仅加魅力，并不能算是真的大众心中的梦中情人。
因此制作了这个mod。

mod 效果：
在太吾成年后(14岁)，
和太吾处于同一格子的人，只要与太吾有过一面之缘的成年人，都会爱慕太吾传人。
如果已经处于爱慕关系，并且太吾也爱慕ta，则对方会尝试主动请求恋爱。
如果已经处于恋爱关系，且你们双方未婚，则对方会尝试主动求婚。

由于游戏的事件系统有点复杂，所以爱慕是必然发生的，而对方的主动请求<del>必须是对方闲下来的时候才会请求，所以</del>是概率发生的(概率大概 20%+)。

### 1.0.1
增加了一些可定制选项。

必须要处于两情相悦状态才会发生求婚。

接受的关系<del>通常不够伦理，比如勾选“亲生父母”，就可以让你的女儿发生回交</del>可以突破游戏的原有限制。

### 1.0.2
增加了人物阶层筛选功能。

修复了配置保存的BUG。

增加了可在不同格产生爱慕的选项(慎用)，可以用来变相举办自己的招亲大会 。

太吾传人可能会想要摆脱一群爱慕者，因此增添新功能——天涯何处无芳草,何必单恋一枝花。
在不勾选“主动爱慕”的时候出现的按钮，点击后会清除世界上所有太吾不爱慕的人物对太吾的爱慕之情。

### 1.0.3
整合了其他两个mod。
[MOD发布\] 情难自已 v1.0.0](https://nga.178.com/read.php?tid=20221567)
[MOD发布\] 一发入魂——指定怀孕概率 v1.0.0](https://nga.178.com/read.php?tid=20223722)

### 1.0.4

同时只能显示一种功能的页面，更符合逻辑。

新增debug模式，
在 The Scroll Of Taiwu\Mods\DreamLover\Settings.xml 中，翻到最后几行，就能看到\<debugmode\>。
默认为 false，如果设置为 true，则会显示完整日志(在umm界面和output_log.txt 都有，可以帮助纠错)
<del> (以及帮你知道你每次的各种判定结果是怎么发生的，包括防绿功能的完整记录) 

### 1.0.5

修复了 v1.0.4 的过月欺辱功能 BUG
开放 DebugMode
更新了防绿功能，目前是开启后，**符合条件**的人不能与太吾之外的**任何人**发生关系。

雨恨云愁功能更改为选中后，单恋太吾的人过月时发生 雨恨云愁 事件(忘记对太吾的感情)。
新版本的配置文件与之前版本不兼容，需要重新设置各种选项。

v1.0.5 以前，如果想要在与人物的互动中主动欺辱，可以安装附件的“发生关系”mod，然后使用基础资源框架加载 txtmod。
v1.0.5 内置发生关系，只需要加载 txtmod 即可。

具体使用或者自己想要当个带文豪自己创作小h文可以参考下面这个帖子的最后一部分。
[[抛砖引玉\] [txtmod] 自定义事件流程教程与修改实例(伏魔救治与主动欺辱)](https://nga.178.com/read.php?tid=20361579)

***2020-02-28 16:29***
修复了 v1.0.5 的“当人物无姓名数据时，主动欺辱报错”的BUG。

***2020-02-28 22:26***
此 MOD 功能基本完成，此后将不会做大的更新。

### 1.0.6

各功能模块动态加载，使过月速度变得正常。

感谢  [[@零下萝莉\]](https://nga.178.com/nuke.php?func=ucp&__inchst=UTF-8&username=零下萝莉)  的帮助。

<details>
<summary>详情与一些自言自语</summary>
如果不需要某个功能，可以直接关掉，从而消除某个功能模块对过月速度的影响。<br/>
特别的，互动中的欺辱效果是常态存在的，不能关闭(除非关闭整个mod)<br/>
当需要某个模块的功能被全部关闭的时候，对应的模块会被卸载。<br/>
可以在 debug 模式下观察到加载、卸载模块的日志。<br/>
理论上不会再有下一次更新了<del>，除非有BUG或者其他有趣想法<br/>
毕竟这个mod本身就是一时兴起的产物<br/>
phorcys大佬太强了，浮动信息就是逐模块动态加载。<br/>
或许以后会考虑把互动欺辱的 txtmod 整合进来<br/>
或许以后会考虑添加更多的互动事件(例如主动 ML)(但是现在的关掉结仇和心情就是主动ML啊)(关掉日志？)<br/>
我就是画饼大师(虽然已经摸了，估计出现 BUG 的时候才会考虑继续更)</del><br/>
</details>

### 1.0.7

武当更新了，正好更新一下mod，修一些陈年BUG，以及圆以前画的几个饼。

+ 修复了防绿功能的BUG<del>之前代码逻辑出错了，与其说防绿不如说防止太吾子嗣出轨</del>
+ 增加了强制发生求婚等事件的选项(强制将求婚、表白事件放到每月的首个事件)
+ 支持指定父母单方面的生育能力
+ 欺辱选项中，新增是否保留记录<del>，使其对纯爱党更友好</del>
+ 调整了debug模式的日志，使其更加易读

## 杂项

### 主动欺辱

该模块作用是添加了一个 EndEvent。(*END&90011&11*，与对方强行发生关系)
其可以接受五个额外参数，分别表示是否跳过战力检定，是否影响双方情绪，是否可能结仇，孩子是否单亲以及是否无日志，0 表示否，1 表示是。
如果忽略，则默认为 *0, 1, 1, 1, 0*。(游戏内的欺辱事件设定)
例如，*END&90011&11&1&0&0&0*，表示必然成功，不影响情绪，不结仇并且孩子有双亲。

下面的是一个示例，可以直接复制保存作为txtmod。

```bash
#,0,1,2,3,4,5,6,7,8,9,10,11

9005,敌对类互动,0,0,,1,900500006|900500001|900500002|900500003|900500004|900500005|900500007,,,,0,,0

900500007,,,-1,（欺辱……）,1,,TIME&5|GN&4,917600002,,0,,0
917600002,确定欺辱,0,-99,MN看着D0的姣好相貌，愈发不能自己……,1,917600003|900700001,,,,0,,0
917600003,,,-1,（强行欺辱……）<color=#4B4B4BFF>（消耗行动力：5）</color>,1,,TIME&5,917600004,TIME&5|END&90011&11&0&1&1&0,0,,0
917600004,欺辱对方,0,0,MN趁D0不备，强行与其发生了关系。,1,917600005,,,,0,,0
917600005,,,-1,（喜不自胜……）,1,,,-1,,0,,0
```

### 不制作主动求爱功能的原因

对于让npc主动爱慕的功能，该mod已经足够完善，因此并不需要。

而对于主动表白和求婚，因为此前已经给过 txtmod 修改事件流程的功能，在这里可以简单介绍一下实现方法。

参考这一段

```bash
231,遭遇请求恋爱,231,0,MN与D0虽互有爱慕之情，却均未主动向对方表露出来……\n这日恰逢二人独处，D0按捺不住，终于出言试探起MN的心意——盼望与MN结为爱侣……,1,23100001|23100002|23100003,,,,0,,0
232,遭遇请求结婚,231,0,MN与D0情投意合，虽已是海誓山盟的爱侣，但一日未能成礼，便始终美中不足……\n于是，D0询问起MN的意见，希望能够与MN早日完婚……,1,23200001|23200002|23200003,,,,0,,0
23100001,,,-1,（求之不得……）,1,,,234,END&2311&1,0,,0
23100002,,,-1,（佯为不知……）,1,,,235,END&2311&2,0,,0
23100003,,,-1,（断然拒绝……）,1,,,236,END&2311&3,0,,0
23200001,,,-1,（求之不得……）,1,,,237,END&2311&4,0,,0
23200002,,,-1,（婉言推脱……）,1,,,238,END&2311&5,0,,0
23200003,,,-1,（断然拒绝……）,1,,,239,END&2311&6,0,,0
233,遭遇请求结义,233,0,MN与D0一见如故，情同手足，\nD0提议与MN共结金兰之契，从今以后有福同享，有难同当……,1,23300001|23300002|23300003,,,,0,,0
23300001,,,-1,（求之不得……）,1,,,240,END&2311&7,0,,0
23300002,,,-1,（婉言推脱……）,1,,,241,END&2311&8,0,,0
23300003,,,-1,（断然拒绝……）,1,,,242,END&2311&9,0,,0
234,同意恋爱请求,231,-99,MN回应了D0的心意，与D0海誓山盟，结为了爱侣！\n\n<color=#8E8E8EFF>（MN与D0结为了爱侣……）\n（D0的心情上升了……）</color>,1,23400001,,,,0,,0
235,推脱恋爱情求,231,-99,MN佯为不知，岔开话题，D0不便再说，失落之情溢于言表之上……\n\n<color=#8E8E8EFF>（D0的心情下降了……）</color>,1,23500001,,,,0,,0
236,拒绝恋爱请求,231,-99,MN断然回绝了D0，D0伤心欲绝，痛苦不已……\n\n<color=#8E8E8EFF>（MN与D0不再相互爱慕了……）\n（D0的心情下降了……）</color>,1,23600001,,,,0,,0
237,同意结婚请求,231,-99,MN回应了D0的请求，\n当下便与D0青庐交拜，定下三生之约，正式结为了夫妻！\n\n<color=#8E8E8EFF>（MN与D0结为了夫妻……）\n（MN与D0洞房花烛，情深无限……）\n（D0的心情上升了……）</color>,1,23400001,,,,0,,0
238,推脱结婚请求,231,-99,MN借口推脱，岔开话题，D0不便再说，失落之情溢于言表之上……\n\n<color=#8E8E8EFF>（D0的心情下降了……）</color>,1,23500001,,,,0,,0
239,拒绝结婚请求,231,-99,MN断然回绝了D0，D0伤心欲绝，痛苦不已……\n\n<color=#8E8E8EFF>（MN与D0不再是爱侣了……）\n（D0的心情下降了……）</color>,1,23600001,,,,0,,0
23400001,,,-1,（喜不自胜！）,1,,,-1,,0,,0
23500001,,,-1,（无话可说……）,1,,,-1,,0,,0
23600001,,,-1,（造化弄人……）,1,,,-1,,0,,0
```

显然可见，恋爱（被表白）事件的起点在231，最终生效的是 END&2311&1，而被求婚事件的起点在232，最终生效的是 END&2311&4。

由于这些事件的作用是，直接添加新的高级关系，因此可以在非爱慕状态下使用。

### 更新地址

[个人项目页面](https://github.com/RedContritio/Taiwu_mods)（只有源码，更新最快应该是）

[太吾绘卷游戏Mod](https://github.com/phorcys/Taiwu_mods)（主分支，每次大更新都会重新编译，推荐）